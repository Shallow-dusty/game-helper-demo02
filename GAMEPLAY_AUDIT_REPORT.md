# 深度游戏逻辑审计报告 (信任环境)

**日期**: 2025-11-30 **审计对象**: `game-helper-demo02` (Gameplay & Logic)
**前提**: 假设所有玩家均为信任玩家，不考虑防作弊安全问题。

## 1. 总体评价

本项目作为一个**辅助工具 (Helper Tool)**
表现出色。它并未试图全自动托管游戏，而是通过提供信息整理、状态标记和规则提示来减轻说书人
(ST) 的负担。这种设计思路在复杂的《血染钟楼》游戏中是非常务实且高效的。

**亮点**:

- 🌟 **信息分层清晰**: ST 能直观看到玩家的"真实身份"与"伪装身份"
  (Drunk/Marionette)，并有明确的视觉标记。
- 📱 **移动端适配**:
  悬浮投票按钮、长按交互、手势缩放等设计使得手机端操作体验良好。
- 🧠 **智能辅助**: 夜间行动面板会自动提示 ST
  "该玩家已中毒/醉酒"，并提供快捷回复模板。
- ⚖️ **规则提示**: 自动检测并显示场上角色相关的 Jinx (克制规则)。

## 2. 核心逻辑审计 (`lib/gameLogic.ts`)

### 2.1 胜负判定 (需改进)

目前的 `checkGameOver` 逻辑过于简化：

- ✅ **正确**: 恶魔死亡 -> 好人胜；存活 <= 2 -> 邪恶胜。
- ❌ **缺失**:
  - **市长 (Mayor)**: 3人存活且无处决时的胜利判定。
  - **邪恶双子 (Evil Twin)**: 只要双子存活，好人无法获胜。
  - **主谋 (Mastermind)**: 恶魔死后游戏应继续一天。
  - **圣徒 (Saint)**: 被处决时邪恶直接获胜。
- **建议**: 增加特殊胜利条件的检测逻辑，或在 UI 上给 ST 提供手动的 "宣布获胜"
  按钮。

### 2.2 夜间行动顺序

- ⚠️ **静态顺序**: `NIGHT_ORDER`
  是硬编码的。虽然涵盖了大部分角色，但某些剧本可能需要特定的行动顺序调整。
- **缺失**: **恶魔/爪牙信息阶段** (Minion/Demon Info)
  未显式包含在队列中，通常这是首夜极重要的一环。

## 3. 游戏流程审计 (`store.ts`)

### 3.1 投票与处决 (关键逻辑偏差)

目前的 `startVote` / `closeVote` 逻辑存在误导性：

- **现状**: 每次提名投票结束后，如果票数过半，系统会提示 "X 票数达标，可被处决"
  甚至直接标记为 `executed`。
- **问题**:
  《血染钟楼》规则是**"得票最高且过半者"**被处决。一天可以有多轮提名。如果 A 得
  6 票，B 随后得 7 票，A 不应被处决，B 应被处决。
- **风险**: 系统消息可能误导 ST 认为第一个达标的人立即死亡。
- **建议**:
  - 将结果描述改为 "票数达标 (当前最高)"。
  - 在白天阶段结束时，增加一个 "结算处决" 的步骤，自动计算谁是最终被处决者。

### 3.2 角色能力实现

- **酒鬼/中毒**: 系统正确识别了状态，但**不会自动生成假信息**。这符合 "Helper"
  定位，但 ST 需要注意手动编造假信息。
- **处女 (Virgin)**: 代码中已包含对处女被提名的特殊警告，这点做得很好。

## 4. 交互体验 (UI/UX)

### 4.1 魔典 (Grimoire)

- **优点**: 视觉效果极佳，支持缩放和拖拽。
- **建议**:
  - **死亡操作**: 目前死亡需要进菜单操作，建议在长按菜单中将 "死亡/复活"
    设为一级选项。
  - **标记 (Reminders)**: 建议支持自定义文本标记，而不仅仅是预设图标。

### 4.2 夜间行动面板

- **优点**: 聚合了所有待处理请求，大大减少了 ST 的认知负荷。
- **建议**: 增加 "批量跳过" 功能，用于快速处理无行动能力的玩家。

## 5. 总结与建议

项目在"辅助"层面做得非常成功，但在"规则裁判"层面还有提升空间。

**优先改进建议**:

1. **修正投票结算文案**: 明确告知 ST "当前最高票"，而非暗示立即处决。
2. **完善胜负逻辑**: 补充市长、双子等特殊角色的判定，或提供手动结束游戏选项。
3. **增强 ST 自由度**: 允许 ST
   随时手动修改票数、强制处决或复活，以应对规则外的特殊情况（如私聊时的特殊能力发动）。
