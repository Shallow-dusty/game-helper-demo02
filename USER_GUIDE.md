# 魔典使用指南 | Grimoire Web User Guide

> **适用人群**: 玩家 & 说书人 | **难度**: ⭐ 入门级 | **版本**: v0.8.0

欢迎使用 **Grimoire Web** -
一个现代化的《染钟楼谜团》线上魔典工具！本指南将带您快速上手所有基础功能。

---

## 📚 快速导航

<table>
<tr>
<td width="50%">

### 👥 玩家篇

- [如何加入游戏](#玩家如何加入游戏)
- [查看魔典](#查看魔典信息)
- [聊天功能](#聊天与私密消息)
- [主动技能](#使用主动技能) ⭐ NEW
- [投票操作](#参与投票)
- [常见问题](#玩家常见问题)

</td>
<td width="50%">

### 🎭 说书人篇

- [创建游戏](#说书人创建游戏)
- [角色分配](#快速分配角色)
- [移动端操作](#移动端说书人操作) ⭐ NEW
- [夜间操作](#夜间阶段操作)
- [投票管理](#投票流程管理)
- [完整手册](./STORYTELLER_MANUAL.md)

</td>
</tr>
</table>

---

## 🆕 v0.8.0 更新概览

### 核心优化

- **项目清理**: 移除了冗余文件，提升项目整洁度
- **安全增强**: 识别并修复了潜在的数据同步风险
- **代码审查**: 完成核心功能模块的全面审查

### 对玩家 (v0.7.0+)

- **主动技能按钮**: 杀手/处女/艺术家等角色可直接点击发动技能
- **详细角色描述**: 切换到"详细模式"查看完整规则说明
- **连接状态显示**: 顶部显示实时连接状态

### 对说书人 (v0.7.0+)

- **移动端长按**: 长按座位500ms弹出操作菜单
- **双重身份系统**: 支持酒鬼/疯子/魔偶的身份错位
- **原子入座**: 防止多人抢座冲突

---

## 👥 玩家指南

### 玩家: 如何加入游戏

**步骤**:

1. **获取房间号**
   - 向说书人询问 4 位数字房间号
   - 例如: `1234`

2. **进入游戏**
   - 打开 Grimoire Web 首页
   - 输入您的昵称（其他玩家会看到）
   - 输入房间号
   - 点击 "加入游戏"

3. **查看连接状态**
   - 顶部 Banner 显示连接状态
   - 🟢 绿色 = 已连接
   - 🟡 黄色 = 正在重连
   - 🔴 红色 = 已断开

### 查看魔典信息

**您能看到**:

- **座位编号**: 从 1 开始顺时针编号
- **玩家昵称**: 显示在座位旁
- **状态图标**:
  - ☠️ 死亡
  - 👻 有幽灵票
  - 🖐 正在举手发言
  - 📍 被提名（投票阶段）
- **当前阶段**: 第X夜/第X天

**您看不到的信息** (仅说书人可见):

- 其他玩家的角色
- 状态标记（中毒/喝醉）
- 提醒标记

### 聊天与私密消息

#### 公开聊天

1. 在聊天框输入消息
2. 确保接收人选择为 "📢 所有人 (Public)"
3. 点击发送 (或按回车)
4. 所有人可见您的消息

#### 私密消息 (Whisper)

1. 如果说书人允许悄悄话，接收人下拉菜单会显示其他玩家
2. 选择目标玩家（如 "🕵️ Alice (3号)"）
3. 输入消息并发送
4. **紫色边框**消息仅您、接收人和说书人可见
5. 其他玩家完全看不到

> 💡 **技巧**: 悄悄话用于隐秘讨论敏感信息，但说书人始终能看到所有悄悄话内容

### 使用主动技能 ⭐ NEW

部分角色拥有可主动发动的技能！

**支持的角色**:

| 角色               | 按钮            | 说明                     |
| ------------------ | --------------- | ------------------------ |
| 杀手 (Slayer)      | 🏹 发动杀手技能 | 选择目标，若为恶魔则击杀 |
| 处女 (Virgin)      | 🕯️ 声明处女身份 | 被镇民提名时触发         |
| 艺术家 (Artist)    | 🎨 向ST提问     | 向说书人提一个是非题     |
| 杂耍艺人 (Juggler) | 🤹 猜测角色     | 第一天猜测最多5人角色    |
| 造谣者 (Gossip)    | 💬 发表造谣     | 公开声明一个陈述         |

**使用方式**:

1. 在控制面板找到您的角色卡
2. 看到技能按钮（仅白天可用）
3. 点击按钮
4. 如需目标，在弹窗中输入
5. 系统自动在聊天中公告

**注意**: 技能只能使用一次！使用后按钮变灰。

### 参与投票

#### 举手发言

1. 白天阶段，点击 "🖐 举手" 按钮申请发言
2. 等待说书人叫您发言
3. 完成发言后，举手状态会自动取消

#### 投票流程

1. **提名阶段**:
   - 说书人开启投票后，所有人看到提名信息
   - 例如: "Alice 提名 Bob 上断头台"

2. **投票阶段**:
   - 您的界面显示两个按钮:
     - "✋ 投票" - 同意处决
     - "👎 弃权" - 不同意处决
   - 点击任意按钮表态

3. **结果公布**:
   - 说书人结束投票后，系统显示结果
   - **票数 > 存活人数/2**: 被提名人被处决（死亡）
   - **票数 ≤ 存活人数/2**: 被提名人存活

---

## 🎭 说书人快速指南

### 移动端说书人操作 ⭐ NEW

**长按交互**: 在手机/平板上，无法右键点击。使用长按替代：

1. **解锁魔典**: 点击右上角 🔓 解锁按钮
2. **长按座位**: 持续按住座位约0.5秒
3. **触觉反馈**: 手机会轻微振动
4. **释放**: 弹出操作菜单

**菜单功能**:

- 分配角色
- 标记状态（死亡/中毒/喝醉）
- 添加提醒标记
- 查看角色详情

3. 点击 "🌙 执行夜间动作"
4. 根据提示选择玩家或做出决策
5. 点击"确认"，系统自动记录日志

**支持的交互**:

- 单选玩家 (小恶魔杀人、僧侣保护)
- 双选玩家 (占卜师查验)
- 二选一决策 (守鸦人选择新角色)
- 确认操作 (首夜信息确认)

### 投票流程管理

1. 玩家举手后，点击 "开始投票"
2. 选择提名人和被提名人
3. 等待玩家投票

> 详细说明请查看 [说书人完整手册](./STORYTELLER_MANUAL.md)

---

## 🔧 系统功能

### 实时同步

- 说书人的所有操作实时同步给所有玩家
- 魔典状态、投票情况、聊天消息即时更新
- 如遇网络波动，刷新页面重新加入即可恢复

### 移动端支持

- 完全适配手机和平板
- 触摸友好的交互设计
- 建议使用现代浏览器（Chrome/Safari/Edge）

### 数据安全

- 所有数据通过 Supabase 加密传输
- 房间号是临时的，游戏结束后房间自动清理
- 历史记录仅保存在 Supabase，不会泄露给其他玩家

---

## ❓ 常见问题

### 玩家常见问题

**Q: 进入房间后看不到其他玩家？**\
A:

- 刷新页面重新加入
- 确认房间号正确
- 检查网络连接

**Q: 发送消息后其他人看不到？**\
A:

- 检查是否误选了私密接收人
- 确认网络连接正常
- 尝试刷新页面

**Q: 我的角色在哪里查看？**\
A:

- **玩家无法自行查看角色**
- 说书人会在夜间私下告知您角色
- 或通过私聊/信息卡片告知

**Q: 如何知道我是否被中毒/喝醉？**\
A:

- **玩家不知道自己是否中毒**（规则设计）
- 喝醉状态同理，只有说书人知道
- 这是游戏的一部分，需要靠推理判断

### 说书人常见问题

**Q: 玩家断线怎么办？**\
A: 玩家刷新页面重新输入房间号即可，座位信息会自动同步

**Q: 如何撤销错误的操作？**\
A:

- 角色分配: 重新点击座位选择新角色
- 投票: 使用"取消投票"按钮
- 夜间操作: 暂时无法撤销，建议谨慎操作

**Q: AI 助手不可用？**\
A:

- 检查 `.env.local` 中 API Key 是否配置
- 尝试切换其他模型
- 检查网络连接

---

## 🎯 快速命令速查表

### 玩家

| 操作     | 位置     | 快捷键 |
| -------- | -------- | ------ |
| 发送消息 | 聊天框   | Enter  |
| 举手发言 | 游戏界面 | -      |
| 投票     | 投票阶段 | -      |

### 说书人

| 操作     | 位置             | 说明                 |
| -------- | ---------------- | -------------------- |
| 切换阶段 | Controls → Phase | ☀ / 🌙 / 📊 按钮     |
| 分配角色 | 点击座位         | 选择角色或状态       |
| 夜间助手 | Night Order      | 🌙 执行夜间动作      |
| 开启投票 | Controls → Vote  | 选择提名人和被提名人 |
| AI 咨询  | Controls → AI    | 输入问题             |
| 游戏结束 | Controls → Game  | 选择获胜阵营         |

---

## 📖 进阶学习

### 新手建议

1. 先作为玩家参与几局，熟悉界面
2. 了解基本规则后再尝试当说书人
3. 使用 AI 助手学习规则判例

### 说书人进阶

1. 阅读 [说书人完整手册](./STORYTELLER_MANUAL.md)
2. 学习使用结构化信息卡片
3. 分析投票历史优化主持策略

### 自定义剧本

- 查看 [README 剧本导入指南](./README.md#剧本导入指南)
- 参考官方 JSON 格式
- 测试自定义角色的夜间助手配置

---

## 🆘 获取帮助

### 技术支持

- GitHub Issues: 报告 Bug 或提出功能建议
- 浏览器控制台 (F12): 查看错误日志

### 社区资源

- [Blood on the Clocktower 官方 Wiki](https://wiki.bloodontheclocktower.com/)
- [Reddit 社区](https://www.reddit.com/r/BloodOnTheClocktower/)

---

<p align="center">
  <strong>祝您游戏愉快！🎲</strong><br>
  May the odds be ever in your favor!
</p>

---

## 📋 附录: 术语表

| 术语     | 英文        | 解释                                       |
| -------- | ----------- | ------------------------------------------ |
| 魔典     | Grimoire    | 说书人的游戏管理工具，显示所有座位和状态   |
| 说书人   | Storyteller | 游戏主持人，负责分配角色、引导流程         |
| 悄悄话   | Whisper     | 私密聊天消息，仅发送人、接收人和说书人可见 |
| 幽灵票   | Ghost Vote  | 死亡玩家的一次性投票机会                   |
| 夜间顺序 | Night Order | 夜间阶段各角色能力的执行顺序               |
| 提名     | Nomination  | 白天阶段提议处决某位玩家                   |
| 处决     | Execution   | 投票通过后玩家死亡                         |
| 中毒     | Poisoned    | 能力失效，玩家不知道自身状态               |
| 喝醉     | Drunk       | 能力失效且可能获得错误信息                 |
