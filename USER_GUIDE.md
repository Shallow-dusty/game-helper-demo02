# 魔典使用指南 | Grimoire Web User Guide

> **适用人群**: 玩家 & 说书人 | **难度**: ⭐ 入门级

欢迎使用 **Grimoire Web** - 一个现代化的《染钟楼谜团》线上魔典工具！本指南将带您快速上手所有基础功能。

---

## 📚 快速导航

<table>
<tr>
<td width="50%">

### 👥 玩家篇
- [如何加入游戏](#玩家如何加入游戏)
- [查看魔典](#查看魔典信息)
- [聊天功能](#聊天与私密消息)
- [投票操作](#参与投票)
- [常见问题](#玩家常见问题)

</td>
<td width="50%">

### 🎭 说书人篇
- [创建游戏](#说书人创建游戏)
- [角色分配](#快速分配角色)
- [夜间操作](#夜间阶段操作) ⭐
- [投票管理](#投票流程管理)
- [完整手册](./STORYTELLER_MANUAL.md)

</td>
</tr>
</table>

---

## 👥 玩家指南

### 玩家: 如何加入游戏

**步骤**:

1. **获取房间号**
   - 向说书人询问 4 位数字房间号
   - 例如: `1234`

2. **进入游戏**
   - 打开 Grimoire Web 首页
   - 输入您的昵称（其他玩家会看到）
   - 输入房间号
   - 点击 "加入游戏"
- **座位编号**: 从 1 开始顺时针编号
- **玩家昵称**: 显示在座位旁
- **状态图标**: 
  - ☠️ 死亡
  - 👻 有幽灵票
  - 🖐 正在举手发言
  - 📍 被提名（投票阶段）

**您看不到的信息** (仅说书人可见):
- 其他玩家的角色
- 状态标记（中毒/喝醉）
- 提醒标记

### 聊天与私密消息

#### 公开聊天
1. 在聊天框输入消息
2. 确保接收人选择为 "📢 所有人 (Public)"
3. 点击发送 (或按回车)
4. 所有人可见您的消息

#### 私密消息 (Whisper)
1. 如果说书人允许悄悄话，接收人下拉菜单会显示其他玩家
2. 选择目标玩家（如 "🕵️ Alice (3号)"）
3. 输入消息并发送
4. **紫色边框**消息仅您、接收人和说书人可见
5. 其他玩家完全看不到

> 💡 **技巧**: 悄悄话用于隐秘讨论敏感信息，但说书人始终能看到所有悄悄话内容

#### 信息卡片 (NEW)
有时说书人会发送**彩色卡片消息**给您，这是结构化信息卡片：
- **蓝色卡片**: 角色查验结果
- **紫色卡片**: 能力使用提示
- **琥珀色卡片**: 游戏提示/规则说明

卡片支持折叠展开（长内容会自动折叠）

### 参与投票

#### 举手发言
1. 白天阶段，点击 "🖐 举手" 按钮申请发言
2. 等待说书人叫您发言
3. 完成发言后，举手状态会自动取消

#### 投票流程
1. **提名阶段**:
   - 说书人开启投票后，所有人看到提名信息
   - 例如: "Alice 提名 Bob 上断头台"

2. **投票阶段**:
   - 您的界面显示两个按钮:
     - "✋ 投票" - 同意处决
     - "👎 弃权" - 不同意处决
   - 点击任意按钮表态

3. **结果公布**:
   - 说书人结束投票后，系统显示结果
   - **票数 > 存活人数/2**: 被提名人被处决（死亡）
   - **票数 ≤ 存活人数/2**: 被提名人存活

#### 幽灵票
- 如果您死亡后被说书人标记了 "👻 幽灵票"
- 您在死亡后有**一次**投票机会
- 使用后幽灵票图标消失，无法再次投票

---

## 🎭 说书人快速指南

### 说书人: 创建游戏
3. 点击 "🌙 执行夜间动作"
4. 根据提示选择玩家或做出决策
5. 点击"确认"，系统自动记录日志

**支持的交互**:
- 单选玩家 (小恶魔杀人、僧侣保护)
- 双选玩家 (占卜师查验)
- 二选一决策 (守鸦人选择新角色)
- 确认操作 (首夜信息确认)

### 投票流程管理

1. 玩家举手后，点击 "开始投票"
2. 选择提名人和被提名人
3. 等待玩家投票
4. 点击 "结束投票" 自动判断结果

**投票历史**:
- 游戏结束后，点击 "📜 历史记录"
- 切换到 "Voting History" tab
- 查看投票趋势图和详细数据

### AI 规则助手

1. 在 Controls → AI tab 输入问题
2. 选择 AI 模型（推荐 DeepSeek R1 或 MiniMax M2）
3. 获取规则建议和判例参考
4. AI 回复仅您可见

> 详细说明请查看 [说书人完整手册](./STORYTELLER_MANUAL.md)

---

## 🔧 系统功能

### 实时同步
- 说书人的所有操作实时同步给所有玩家
- 魔典状态、投票情况、聊天消息即时更新
- 如遇网络波动，刷新页面重新加入即可恢复

### 移动端支持
- 完全适配手机和平板
- 触摸友好的交互设计
- 建议使用现代浏览器（Chrome/Safari/Edge）

### 数据安全
- 所有数据通过 Supabase 加密传输
- 房间号是临时的，游戏结束后房间自动清理
- 历史记录仅保存在 Supabase，不会泄露给其他玩家

---

## ❓ 常见问题

### 玩家常见问题

**Q: 进入房间后看不到其他玩家？**  
A: 
- 刷新页面重新加入
- 确认房间号正确
- 检查网络连接

**Q: 发送消息后其他人看不到？**  
A:
- 检查是否误选了私密接收人
- 确认网络连接正常
- 尝试刷新页面

**Q: 我的角色在哪里查看？**  
A:
- **玩家无法自行查看角色**
- 说书人会在夜间私下告知您角色
- 或通过私聊/信息卡片告知

**Q: 如何知道我是否被中毒/喝醉？**  
A:
- **玩家不知道自己是否中毒**（规则设计）
- 喝醉状态同理，只有说书人知道
- 这是游戏的一部分，需要靠推理判断

### 说书人常见问题

**Q: 玩家断线怎么办？**  
A: 玩家刷新页面重新输入房间号即可，座位信息会自动同步

**Q: 如何撤销错误的操作？**  
A:
- 角色分配: 重新点击座位选择新角色
- 投票: 使用"取消投票"按钮
- 夜间操作: 暂时无法撤销，建议谨慎操作

**Q: AI 助手不可用？**  
A:
- 检查 `.env.local` 中 API Key 是否配置
- 尝试切换其他模型
- 检查网络连接

---

## 🎯 快速命令速查表

### 玩家
| 操作 | 位置 | 快捷键 |
|------|------|--------|
| 发送消息 | 聊天框 | Enter |
| 举手发言 | 游戏界面 | - |
| 投票 | 投票阶段 | - |

### 说书人
| 操作 | 位置 | 说明 |
|------|------|------|
| 切换阶段 | Controls → Phase | ☀ / 🌙 / 📊 按钮 |
| 分配角色 | 点击座位 | 选择角色或状态 |
| 夜间助手 | Night Order | 🌙 执行夜间动作 |
| 开启投票 | Controls → Vote | 选择提名人和被提名人 |
| AI 咨询 | Controls → AI | 输入问题 |
| 游戏结束 | Controls → Game | 选择获胜阵营 |

---

## 📖 进阶学习

### 新手建议
1. 先作为玩家参与几局，熟悉界面
2. 了解基本规则后再尝试当说书人
3. 使用 AI 助手学习规则判例

### 说书人进阶
1. 阅读 [说书人完整手册](./STORYTELLER_MANUAL.md)
2. 学习使用结构化信息卡片
3. 分析投票历史优化主持策略

### 自定义剧本
- 查看 [README 剧本导入指南](./README.md#剧本导入指南)
- 参考官方 JSON 格式
- 测试自定义角色的夜间助手配置

---

## 🆘 获取帮助

### 技术支持
- GitHub Issues: 报告 Bug 或提出功能建议
- 浏览器控制台 (F12): 查看错误日志

### 社区资源
- [Blood on the Clocktower 官方 Wiki](https://wiki.bloodontheclocktower.com/)
- [Reddit 社区](https://www.reddit.com/r/BloodOnTheClocktower/)

---

<p align="center">
  <strong>祝您游戏愉快！🎲</strong><br>
  May the odds be ever in your favor!
</p>

---

## 📋 附录: 术语表

| 术语 | 英文 | 解释 |
|------|------|------|
| 魔典 | Grimoire | 说书人的游戏管理工具，显示所有座位和状态 |
| 说书人 | Storyteller | 游戏主持人，负责分配角色、引导流程 |
| 悄悄话 | Whisper | 私密聊天消息，仅发送人、接收人和说书人可见 |
| 幽灵票 | Ghost Vote | 死亡玩家的一次性投票机会 |
| 夜间顺序 | Night Order | 夜间阶段各角色能力的执行顺序 |
| 提名 | Nomination | 白天阶段提议处决某位玩家 |
| 处决 | Execution | 投票通过后玩家死亡 |
| 中毒 | Poisoned | 能力失效，玩家不知道自身状态 |
| 喝醉 | Drunk | 能力失效且可能获得错误信息 |
